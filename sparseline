#!/bin/env bash

XXX=$PS1

# get branch
function gitty()
{
    declare status
    declare star

    # two layers deep -- Ben Carson
    for path in {'.','..','../..'}/.git/HEAD
    do
        if [[ -r $path ]]
        then
            B=$(<"${path}")
            B="${B//*\//}"

            # if ! git diff --quiet
            # then
            #     star=$'*'
            # fi

            dirbase=$(dirname "${path}")

            hash=$(<"${dirbase}/refs/heads/${B}")
            H="${hash:0:7}"

            status+="« ${star}${B}#${H} »"


            break
        fi
    done

    export PS1="${status}${XXX}"
}
export PROMPT_COMMAND=gitty
