#!/bin/env bash

declare _PS1
_PS1=$PS1

# get branch
function gitty()
{
    local status
    local star


    for path in {'.','..','../..'}/.git/HEAD
    do
        if [[ -r $path ]]
        then
            B=$(<"${path}")
            B="${B//*\//}"

            dirbase=$(dirname "${path}")

            while read -r words
            do
                str="${pre}${words}"
                pre="${words}"
                [[ $str =~ \"$B\"\]remote\ =\ (.*) ]] && R="${BASH_REMATCH[1]}" && break
            done < "${dirbase}/config"


            _H=$(<"${dirbase}/refs/heads/${B}")
            H="${_H:0:7}"

            status="« ${star}${R}/${B}#${H} »"

            break
        fi
    done

    export PS1="${status}${_PS1}"
}
export PROMPT_COMMAND=gitty
