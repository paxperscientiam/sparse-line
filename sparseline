#!/bin/env bash

XXX=$PS1

# get branch
function gitty()
{
    declare status
    declare star

    # two layers deep -- Ben Carson
    for path in {'.','..','../..'}/.git/HEAD
    do
        if [[ -r $path ]]
        then
            branch=$(<"${path}")
            branch="${branch//*\//}"

            # if ! git diff --quiet
            # then
            #     star=$'*'
            # fi

            dirbase=$(dirname "${path}")

            hash=$(<"${dirbase}/refs/heads/${branch}")
            short_hash="${hash:0:7}"

            status+="« ${star}${branch} »"


            break
        fi
    done

    export PS1="${status}${XXX}"
}
export PROMPT_COMMAND=gitty
